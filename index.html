<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>توصيات-ياسر</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>
    <style>
        /* كل أنماط CSS السابقة تبقى كما هي مع هذه الإضافات */
        
        /* التنسيق الجديد للمؤشرات */
        .chart-wrapper {
            display: flex;
            flex-direction: row-reverse;
            gap: 15px;
            margin-top: 20px;
        }
        
        .main-chart-container {
            flex: 3;
            height: 400px;
        }
        
        .indicators-sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .indicator-chart {
            height: 120px;
            background: var(--indicator-bg, #f9f9f9);
            border-radius: 8px;
            padding: 10px;
            position: relative;
        }
        
        /* ألوان الفوليوم المعدلة */
        .volume-up {
            background-color: rgba(46, 204, 113, 0.7) !important;
        }
        
        .volume-down {
            background-color: rgba(231, 76, 60, 0.7) !important;
        }
        
        /* تحسينات الوضع الليلي */
        .dark-mode .volume-up {
            background-color: rgba(46, 204, 113, 0.9) !important;
        }
        
        .dark-mode .volume-down {
            background-color: rgba(231, 76, 60, 0.9) !important;
        }
    </style>
</head>
<body>
    <!-- باقي الهيكل HTML يبقى كما هو حتى recommendations-container -->

    <script>
        // ... (أكواد JavaScript السابقة تبقى كما هي حتى displayRecommendations)
        
        function displayRecommendations(recommendations) {
            // ... (الكود السابق يبقى كما هو حتى coinEl.innerHTML)
            
            coinEl.innerHTML = `
                <!-- ... (الأجزاء العلوية تبقى كما هي) -->
                
                <div class="chart-wrapper">
                    <div class="main-chart-container">
                        <canvas id="chart-${coin.symbol}"></canvas>
                    </div>
                    
                    <div class="indicators-sidebar">
                        <div class="indicator-chart">
                            <div class="indicator-title">MACD (12,26,9)</div>
                            <canvas id="macd-${coin.symbol}"></canvas>
                        </div>
                        <div class="indicator-chart">
                            <div class="indicator-title">RSI (14)</div>
                            <canvas id="rsi-${coin.symbol}"></canvas>
                        </div>
                        <div class="indicator-chart">
                            <div class="indicator-title">VOLUME</div>
                            <canvas id="volume-${coin.symbol}"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- ... (الأجزاء السفلية تبقى كما هي) -->
            `;
            
            // ... (باقي الدوال تبقى كما هي)
        }
        
        function renderIndicators(coin) {
            // ... (الكود السابق يبقى كما هو حتى رسم Volume)
            
            // إنشاء ألوان الفوليوم حسب اتجاه السعر
            const volumeColors = [];
            for (let i = 1; i < coin.history.length; i++) {
                if (coin.history[i] >= coin.history[i-1]) {
                    volumeColors.push('volume-up');
                } else {
                    volumeColors.push('volume-down');
                }
            }
            volumeColors.push(volumeColors[volumeColors.length-1] || 'volume-up');
            
            // رسم Volume المعدل
            const volumeCtx = document.getElementById(`volume-${coin.symbol}`).getContext('2d');
            new Chart(volumeCtx, {
                type: 'bar',
                data: {
                    labels: Array(coin.volumes.length).fill(''),
                    datasets: [{
                        label: 'Volume',
                        data: coin.volumes,
                        backgroundColor: volumeColors,
                        borderColor: 'transparent',
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { 
                            display: true,
                            grid: { 
                                color: isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)' 
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
