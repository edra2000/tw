<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙˆØµÙŠØ§Øª-ÙŠØ§Ø³Ø±</title>
    <!-- Load Chart.js first -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- Then load the date adapter -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.3.0/dist/chartjs-adapter-date-fns.min.js"></script>
    <!-- Finally load the financial chart extension -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@1.2.0/dist/chartjs-chart-financial.min.js"></script>
    
    <style>
        /* ... (Ø§Ø¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø£Ù†Ù…Ø§Ø· CSS ÙƒÙ…Ø§ Ù‡ÙŠ) ... */
    </style>
</head>
<body>
    <!-- ... (Ø§Ø¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ù‡ÙŠÙƒÙ„ HTML ÙƒÙ…Ø§ Ù‡Ùˆ) ... -->

    <script>
        // Ø¯Ø§Ù„Ø© Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
        function waitForLibraries() {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const maxAttempts = 10;
                const interval = setInterval(() => {
                    if (window.Chart && window.Chart.controllers && window.Chart.controllers.candlestick) {
                        clearInterval(interval);
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        clearInterval(interval);
                        reject(new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'));
                    }
                    attempts++;
                }, 100);
            });
        }

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
                await waitForLibraries();
                
                // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                const requiredElements = [
                    'analyze-btn', 'refresh-btn', 'interval', 'limit',
                    'loading', 'error', 'recommendations-container', 'darkModeToggle'
                ];
                
                requiredElements.forEach(id => {
                    if (!document.getElementById(id)) {
                        throw new Error(`Ø§Ù„Ø¹Ù†ØµØ± #${id} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø©`);
                    }
                });

                const analyzeBtn = document.getElementById('analyze-btn');
                const refreshBtn = document.getElementById('refresh-btn');
                const intervalSelect = document.getElementById('interval');
                const limitSelect = document.getElementById('limit');
                const loadingEl = document.getElementById('loading');
                const errorEl = document.getElementById('error');
                const recommendationsContainer = document.getElementById('recommendations-container');
                const darkModeToggle = document.getElementById('darkModeToggle');
                
                // Dark Mode Toggle
                if (localStorage.getItem('darkMode') === 'enabled') {
                    document.body.classList.add('dark-mode');
                    darkModeToggle.textContent = 'â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ';
                }
                
                darkModeToggle.addEventListener('click', () => {
                    document.body.classList.toggle('dark-mode');
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    
                    darkModeToggle.textContent = isDarkMode ? 'â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ' : 'ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ';
                    localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹
                    if (recommendationsContainer.innerHTML !== '') {
                        analyzeCoins();
                    }
                });
                
                // ... (Ø§Ø¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ) ...

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('error').textContent = error.message;
                document.getElementById('error').style.display = 'block';
            }
        });
    </script>
</body>
</html>
